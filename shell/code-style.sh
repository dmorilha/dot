#!/bin/bash

SED_BINARY=gsed;

cat | $SED_BINARY -E \
    -e 's/$//;' \
    -e ':a; s/^(\t*)[ ]{1,4}/\1\t/; ta;' \
    -e 's/\)[ \t]*\{/) {/;' \
    -e 's/^([ \t]*)([^ \t]+)[ \t]*(\/\/.*)$/\1\3\n\1\2/;' \
    -e 's/([a-zA-Z0-9_]+)[ \t]*\(/\1(/;' \
    -e 's/if[ \t]*\(/if (/;' \
    -e 's/catch[ \t]*\(/catch (/;' \
    -e 's/for[ \t]*\(/while (/;' \
    -e 's/function[ \t]*\(/function (/;' \
    -e 's/switch[ \t]*\(/switch (/;' \
    -e 's/while[ \t]*\(/while (/;' \
	-e 's/\}[ \t]*else[ \t]*\{/} else {/g;' \
    -e "s/([a-zA-Z0-9_\(\)'\"])[ \t]*([+-/*^&%=<>])[ \t]*([a-zA-Z0-9_\(\)'\"]+)/\1 \2 \3/g;" \
    -e "s/([a-zA-Z0-9_\(\)'\"])[ \t]*([+-/*^&%=<>]=)[ \t]*([a-zA-Z0-9_\(\)'\"]+)/\1 \2 \3/g;" \
    -e "s/([a-zA-Z0-9_\(\)'\"])[ \t]*([!=]==)[ \t]*([a-zA-Z0-9_\(\)'\"]+)/\1 \2 \3/g;" \
    -e "s/([a-zA-Z0-9_'\"])[ \t]*:[ \t]*([a-zA-Z0-9_\(\)'\"]+)/\1: \2/g;" \
    -e 's/([^ \t])[ \t]*,[ \t]*/\1, /g;' \
    -e 's/[ \t]*\)/)/g;' \
    -e 's/\([ \t]*/(/g;' \
    -e 's/\(![ \t]*/( ! /;' \
	-e 's/[ \t]*\.[ \t]*/./g;' \
    -e 's/[ \t]*;/;/g;' \
    -e 's/[ \t]*$//;' \
